---
import Card from './Card.astro';

// @ts-ignore -- Makes TypeScript happy
import { JSDOM } from 'jsdom';

export interface Props { 
    name: string;
    description: string;
    url: string;
    image: string | null;
}

let { image, name, description, url } = Astro.props;

if (!image) {
    const response = await fetch(url);
    const html = await response.text();
    const dom = new JSDOM(html);
    const meta = dom.window.document.querySelector('meta[property="og:image"]');
    if (meta) {
        image = meta.getAttribute('content');
    }
}
---

<Card
    title={name}
    body={description}
    link={url}
    animateFrom="left"
    animationOffset="0"
    newTab={true}
    image={image}
    labelDisappears={true}
/>
